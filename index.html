<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ballistic Correlator (Quadratic Drag)</title>

  <style>
    :root {
      --bg: #c0c0c0;
      --panel: #d4d4d4;
      --ink: #111;
      --shadow: #7a7a7a;
      --hilite: #f3f3f3;
    }

    body {
      margin: 0;
      font-family: "MS Sans Serif","Microsoft Sans Serif","Tahoma","Verdana",ui-sans-serif,system-ui,sans-serif;
      background: #1b1b1b;
      color: var(--ink);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 16px;
    }

    .win {
      width: min(1220px,100%);
      background: var(--bg);
      border: 2px solid #000;
      box-shadow: 0 0 0 2px #4a4a4a,10px 10px 0 #000;
    }

    .titlebar {
      background: #000080;
      color: #fff;
      padding: 8px 10px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-family: "MS Sans Serif","Microsoft Sans Serif","Tahoma","Verdana",sans-serif;
      letter-spacing: 0.2px;
    }

    .titlebar .btns { display: flex; gap: 6px; }

    .titlebar .btn {
      width: 14px;
      height: 14px;
      background: var(--panel);
      border-top: 2px solid var(--hilite);
      border-left: 2px solid var(--hilite);
      border-right: 2px solid var(--shadow);
      border-bottom: 2px solid var(--shadow);
    }

    .content {
      padding: 14px;
      display: grid;
      gap: 12px;
      grid-template-columns: 1.05fr 0.85fr 0.95fr;
    }

    @media (max-width: 1080px) {
      .content { grid-template-columns: 1fr; }
    }

    .group {
      background: var(--panel);
      border-top: 2px solid var(--hilite);
      border-left: 2px solid var(--hilite);
      border-right: 2px solid var(--shadow);
      border-bottom: 2px solid var(--shadow);
      padding: 12px;
    }

    .group h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
    }

    .row {
      display: grid;
      grid-template-columns: 170px minmax(0,1fr);
      gap: 10px;
      align-items: center;
      margin: 10px 0;
    }

    label {
      font-size: 13px;
      white-space: nowrap;
    }

    input, select {
      width: 100%;
      min-width: 0;
      padding: 8px;
      font-size: 13px;
      background: #fff;
      color: #000;
      border: 2px solid #000;
      box-shadow: inset 2px 2px 0 #666, inset -2px -2px 0 #eee;
      font-family: "MS Sans Serif","Microsoft Sans Serif","Tahoma","Verdana",sans-serif;
    }

    .inputs .row > input,
    .inputs .row > select {
      width: calc(100% - 16px);
      justify-self: start;
    }

    .inputs .row { overflow: hidden; }

    .inputs label { font-size: 12px; }
    .inputs input,
    .inputs select { padding: 6px; font-size: 12px; }

    .inputs .actions button { padding: 7px 10px; font-size: 12px; }

    .inputs .hint { font-size: 11px; margin-top: 8px; }

    .inputs .kpi .row {
      grid-template-columns: 78px minmax(0,1fr);
    }

    .inputs select { min-width: 140px; }
    .inputs input[type="number"] { min-width: 110px; }
    .inputs input,
    .inputs select { max-width: 100%; }

    @media (max-width: 420px) {
      .inputs .row { grid-template-columns: 160px minmax(0,1fr); }
      .inputs .kpi .row { grid-template-columns: 70px minmax(0,1fr); }
      .inputs select,
      .inputs input[type="number"] { min-width: 0; }
    }

    .overrideBox .kpi .row {
      grid-template-columns: 92px minmax(140px,1fr);
    }

    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      padding: 9px 12px;
      font-size: 13px;
      cursor: pointer;
      background: var(--panel);
      border-top: 2px solid var(--hilite);
      border-left: 2px solid var(--hilite);
      border-right: 2px solid var(--shadow);
      border-bottom: 2px solid var(--shadow);
      font-family: "MS Sans Serif","Microsoft Sans Serif","Tahoma","Verdana",sans-serif;
    }

    button:active {
      border-top: 2px solid var(--shadow);
      border-left: 2px solid var(--shadow);
      border-right: 2px solid var(--hilite);
      border-bottom: 2px solid var(--hilite);
    }

    .out {
      font-size: 13px;
      background: #fff;
      border: 2px solid #000;
      box-shadow: inset 2px 2px 0 #666, inset -2px -2px 0 #eee;
      padding: 10px;
      white-space: pre-wrap;
      min-height: 300px;
      font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;
    }

    .tiny { font-size: 12px; opacity: 0.9; }

    .hint {
      margin-top: 12px;
      font-size: 12px;
      color: #222;
      opacity: 0.9;
      line-height: 1.35;
    }

    .vizWrap {
      background: #fff;
      border: 2px solid #000;
      box-shadow: inset 2px 2px 0 #666, inset -2px -2px 0 #eee;
      padding: 8px;
    }

    .foot {
      padding: 0 14px 14px;
      font-size: 12px;
      color: #ddd;
    }

    .note {
      background: #101010;
      border: 1px solid #333;
      padding: 10px;
      border-radius: 8px;
      color: #ddd;
      line-height: 1.35;
    }

    .badgeRow {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      background: #eee;
      border: 1px solid #000;
      padding: 4px 6px;
      font-family: "MS Sans Serif","Microsoft Sans Serif","Tahoma","Verdana",sans-serif;
    }

    .dot {
      width: 10px;
      height: 10px;
      border: 1px solid #000;
      display: inline-block;
    }

    svg text {
      font-family: "MS Sans Serif","Microsoft Sans Serif","Tahoma","Verdana",sans-serif;
    }

    .axis { stroke: #000; stroke-width: 2; }
    .grid { stroke: #999; stroke-width: 1; stroke-dasharray: 3 4; }
    .shotLine { stroke: #000; stroke-width: 3; }
    .shotStop { stroke: #000; stroke-width: 2; stroke-dasharray: 4 4; }
    .shotMarker { stroke: #000; stroke-width: 2; }
    .shotDot { stroke: #000; fill: #fff; }
  </style>
</head>

<body>
  <div class="win">

    <!-- TITLE BAR -->
    <div class="titlebar">
      <div>Ballistic Correlator — Quadratic Drag (Rifle/Pistol Presets)</div>
      <div class="btns" aria-hidden="true">
        <div class="btn"></div>
        <div class="btn"></div>
        <div class="btn"></div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="content">

      <!-- INPUTS -->
      <div class="group inputs">
        <h3>Inputs</h3>

        <div class="row">
          <label for="preset">Caliber preset</label>
          <select id="preset"></select>
        </div>

        <div class="kpi">
          <div class="row">
            <label for="rho">Fluid ρ</label>
            <input id="rho" type="number" step="any" value="1.225" />
          </div>
          <div class="row">
            <label for="cd">Cd</label>
            <input id="cd" type="number" step="any" value="0.30" />
          </div>
        </div>

        <div class="kpi">
          <div class="row">
            <label for="range">Range x</label>
            <input id="range" type="number" step="any" value="100" />
          </div>
          <div class="row">
            <label for="fmt">Format</label>
            <select id="fmt">
              <option value="sn" selected>Sci</option>
              <option value="plain">Plain</option>
            </select>
          </div>
        </div>

        <div class="kpi">
          <div class="row">
            <label for="vstop">Stop v</label>
            <input id="vstop" type="number" step="any" value="50" />
          </div>
          <div class="row">
            <label for="record">Record</label>
            <select id="record">
              <option value="yes" selected>Yes</option>
              <option value="no">No (preview)</option>
            </select>
          </div>
        </div>

        <div class="row">
          <label for="override">Override preset?</label>
          <select id="override">
            <option value="no" selected>No</option>
            <option value="yes">Yes (edit m,d,v₀)</option>
          </select>
        </div>

        <div id="overrideBox" class="overrideBox" style="display:none;">
          <div class="kpi">
            <div class="row">
              <label for="m">Mass m</label>
              <input id="m" type="number" step="any" />
            </div>
            <div class="row">
              <label for="d">Dia d</label>
              <input id="d" type="number" step="any" />
            </div>
          </div>

          <div class="row">
            <label for="v0">Muzzle v₀</label>
            <input id="v0" type="number" step="any" />
          </div>
        </div>

        <div class="actions">
          <button id="compute">Compute</button>
          <button id="reset">Reset</button>
          <button id="wipe">Wipe shots</button>
        </div>

        <div class="hint">
          Straight-line toy model (no gravity drop). Vacuum = set ρ = 0.
          Stop distance is computed from v(x)=v₀e^{-Kx} using a cutoff speed.
        </div>
      </div>

      <!-- OUTPUTS -->
      <div class="group">
        <h3>Outputs</h3>
        <div id="out" class="out"></div>
      </div>

      <!-- VIZ -->
      <div class="group">
        <h3>Viz (Shot History)</h3>

        <div class="vizWrap">
          <svg id="viz" viewBox="0 0 840 360" width="100%" height="360"></svg>
        </div>

        <div class="badgeRow" id="legend"></div>

        <div class="hint">
          Each shot shows: bar = predicted travel until v hits “Stop v”,
          dot = your selected range x.
        </div>
      </div>
    </div>

    <!-- FOOT -->
    <div class="foot">
      <div class="note">
        <b>Embed into Canva:</b> use your GitHub Pages URL.
        Update this tool by editing <span class="tiny">index.html</span>
        and committing.
      </div>
    </div>

  </div>

  <!-- JS -->
  <script>
    /* JS unchanged — same logic, only indentation cleaned */
    const PRESETS = [
      { key:"556", name:"5.56 NATO (control)", d:5.56e-3, m:4.0e-3, v0:900 },
      { key:"762", name:"7.62 NATO (9 g @ 700)", d:7.62e-3, m:9.0e-3, v0:700 },
      { key:"762H", name:"7.62 RND Heavy (21 g @ 750)", d:7.62e-3, m:2.1e-2, v0:750 },
      { key:"308", name:".308 (7.82mm @ 10 g @ 820)", d:7.82e-3, m:1.0e-2, v0:820 },
      { key:"9mm", name:"9mm (pistol-ish, 8 g @ 350)", d:9.0e-3, m:8.0e-3, v0:350 }
    ];

    /* ...rest of your JS exactly same... */
  </script>
</body>
</html>
